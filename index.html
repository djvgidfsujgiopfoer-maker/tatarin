<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–¢–∞–ø–∞–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
<style>
/* --- –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö (–¥–æ 768px) --- */
@media (max-width: 768px) {
  html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;

    /* –§–∏–∫—Å –±–∞–≥–∞ —Å —Ñ–æ–Ω–æ–º –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö */
    display: block;

    background: url('background.jpg') no-repeat center center fixed;
    background-size: cover !important;

    font-family: Arial, sans-serif;
    overflow: hidden;
    user-select: none;
  }
}

/* --- –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞—Ö (–æ—Ç 769px –∏ –≤—ã—à–µ) --- */
@media (min-width: 769px) {
  html, body {
    height: 100%;
    margin: 0;

    /* –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –±—ã–ª–æ! */
    display: flex;
    justify-content: center;
    align-items: flex-end;

    background: url('background.jpg') no-repeat center bottom;
    background-size: cover;

    font-family: Arial, sans-serif;
    overflow: hidden;
    user-select: none;
  }
}
body, #character { touch-action: manipulation; }

#gameWrap {
  position: relative;
  width: 90vw;
  max-width: 400px;
  height: 100vh;
  text-align: center;
  overflow: visible;
}

/* –°—á—ë—Ç—á–∏–∫ */
#counter {
  position: absolute;
  bottom: calc(160px + 34vh + 8px);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 0;
  pointer-events: none;
  z-index: 20;
  white-space: nowrap;
  transition: bottom 0.25s ease, opacity 0.3s ease;
}
@media (max-width: 768px) {
  #counter {
    bottom: calc(140px + 60vh + 8px);
  }
}
#counter img { height: clamp(100px,10vw,70px); width: auto; vertical-align: middle; }
#counterNumber { font-weight: bold; font-size: clamp(20px,6vw,40px); color: #3c9c44; text-shadow:2px 2px 4px rgba(0,0,0,0.4); line-height:1; transform:translateY(-2px); }

/* –ü–µ—Ä—Å–æ–Ω–∞–∂ */
#characterWrapper {
  position: absolute;
  bottom: 125px;
  left: 50%;
  transform: translateX(-50%) scale(1);
  transform-origin: center bottom;
  width: 90%;
  max-width: 320px;
  height: clamp(220px, 34vh, 320px);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  transition: transform 0.12s ease, opacity 0.3s ease;
  z-index: 10;
}
#character {
  display:block;
  width:100%;
  height:auto;
  cursor:pointer;
  -webkit-user-drag:none;
  user-drag:none;
}

/* –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é */
#gameMenu {
  display:flex;
  justify-content:center;
  height:120px;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,0.3);
  z-index:50;
  position: fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:12px;
  width:90vw;
  max-width:420px;
  background-color:#27792e;
}
.menuBtn { flex:1; background-color:#1c441f; color:#fff; font-weight:bold; font-size:clamp(20px,5vw,28px); padding:25px 0; border:none; cursor:pointer; transition: background-color 0.2s ease, transform 0.1s ease; }
.menuBtn:not(:last-child) { border-right:1px solid rgba(255,255,255,0.3); }
.menuBtn:hover { background-color:#2e8c34; transform: scale(1.02); }

/* –≠—Ñ—Ñ–µ–∫—Ç + */
.coin { position:absolute; font-size:clamp(14px,4vw,24px); font-weight:bold; color:rgb(0,255,76); pointer-events:none; animation:coinAnim 0.8s forwards; text-shadow:0 1px 2px rgba(0,0,0,0.3); white-space:nowrap; z-index:999; }
@keyframes coinAnim { 0%{opacity:1; transform:translateY(0) scale(1);} 40%{transform:translateY(-26px) scale(1.4);} 80%{transform:translateY(-48px) scale(1.1); opacity:0.6;} 100%{transform:translateY(-70px) scale(0.6); opacity:0;} }

/* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
#loader { position:fixed; top:0; left:0; width:100vw; height:100vh; background:#000; display:flex; justify-content:center; align-items:center; z-index:9999; overflow:hidden; }
#loader video {height:100%; width:auto; object-fit:contain; }
.hidden { display:none; }

/* –í–∫–ª–∞–¥–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π */
#upgrade-screen, #airdrop-screen {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:calc(100% - 120px);
  display:none;
  flex-direction:column;
  justify-content:flex-start;
  align-items:center;
  z-index:30;
  background: rgba(0,0,0,0.3);
  opacity:0;
  transition: opacity 0.3s ease;
}
#upgrade-screen.active, #airdrop-screen.active { display:flex; opacity:1; }

/* –í–∫–ª–∞–¥–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π */
#upgrade-tabs { display:flex; justify-content:center; margin-top:60px; margin-bottom:40px; gap:20px; }
.upgrade-tab { background-color:#1c441f; color:#fff; font-weight:bold; font-size:clamp(16px,4vw,24px); padding:14px 28px; border-radius:10px; cursor:pointer; transition:background-color 0.2s ease, transform 0.1s ease; border:none; }
.upgrade-tab.active { background-color:#3da64b; }
.upgrade-tab:hover { background-color:#2e8c34; transform:scale(1.05); }

/* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
.upgrade-content { display:none; flex-direction:column; align-items:center; justify-content:center; flex-grow:1; opacity:0; transition: opacity 0.3s ease; }
.upgrade-content.active { display:flex; opacity:1; }

.upgrade-btn { padding:20px 100px; font-size:clamp(18px,5vw,28px); cursor:pointer; border:none; border-radius:20px; background-color:#2e8c34; color:#fff; font-weight:bold; box-shadow:0 4px 8px rgba(0,0,0,0.3); transition:transform 0.1s ease, background-color 0.2s ease; margin-top:15px; }

/* –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ */
#charSelect { display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin-top:6px; width:100%; }
.char-choice { width:140px; text-align:center; cursor:pointer; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; }
.char-choice img { width:120px; height:120px; object-fit:contain; border-radius:10px; border:3px solid transparent; background:rgba(0,0,0,0.18); display:block; }
.char-choice.active img { border:3px solid #3da64b; box-shadow:0 6px 18px rgba(0,0,0,0.35); }
.char-choice p { color:#fff; font-size:16px; font-weight:700; margin:8px 0 0 0; }
/* üî• –û–ì–ù–ï–ù–ù–´–ô –°–ß–Å–¢–ß–ò–ö –î–õ–Ø –î–ï–ú–û–ú–ê–ö–°–ê */
.fire-counter {
  animation: fireGlow 1.6s infinite alternate ease-in-out;
  text-shadow:
      0 0 12px #ff6a00,
      0 0 22px #ff3c00,
      0 0 35px rgba(255,60,0,0.7),
      0 0 50px rgba(255,120,0,0.4);
  color: #ffdd55 !important;
}

@keyframes fireGlow {
  0% {
    color: #ffdd55;
    text-shadow:
      0 0 8px #ff6a00,
      0 0 16px #ff3c00,
      0 0 28px rgba(255,60,0,0.7);
  }
  50% {
    color: #ffba33;
    text-shadow:
      0 0 20px #ff8800,
      0 0 32px #ff4400,
      0 0 55px rgba(255,80,0,0.9),
      0 0 80px rgba(255,40,0,0.6);
  }
  100% {
    color: #ffd966;
    text-shadow:
      0 0 10px #ff5500,
      0 0 25px #ff2200,
      0 0 40px rgba(255,30,0,0.7);
  }
}

/* üî• –≠—Ñ—Ñ–µ–∫—Ç –¥—ã–º–∞ */
.fire-smoke {
  position: relative;
}

.fire-smoke::after {
  content: "";
  position: absolute;
  top: -25px;
  left: 50%;
  width: 45px;
  height: 45px;
  transform: translateX(-50%);
  background: radial-gradient(circle, rgba(255,255,255,0.25), transparent 70%);
  animation: smokeMove 2s infinite ease-in-out;
  opacity: 0.6;
}

@keyframes smokeMove {
  0% { transform: translateX(-50%) translateY(0) scale(0.9); opacity: 0.7; }
  50% { transform: translateX(-50%) translateY(-12px) scale(1.2); opacity: 0.4; }
  100% { transform: translateX(-50%) translateY(0) scale(0.9); opacity: 0.7; }
}
</style>
</head>
<body>

<div id="loader">
  <video autoplay muted playsinline>
    <source src="pivko.mp4" type="video/mp4">
  </video>
</div>

<div id="gameWrap">
  <div id="counter">
    <img src="govno.png" alt="–°–≤–∏–Ω–∫–æ–π–Ω–æ–≤" id="counterText">
    <span id="counterNumber">0</span>
  </div>

  <div id="rank">–†–∞–Ω–≥: –ü—Ä–∞—Å–∫—É—Ä–∏–æ—Ç ü§µüèø‚Äç‚ôÇÔ∏è</div>
  <div id="rank-popup" class="hidden">üéâ –ù–æ–≤—ã–π —Ä–∞–Ω–≥!</div>

  <div id="characterWrapper">
    <img id="character" src="obichni.png" alt="–ü–µ—Ä—Å–æ–Ω–∞–∂">
  </div>

  <div id="upgrade-screen">
    <div id="upgrade-tabs">
      <button class="upgrade-tab active" data-target="profit">–ü—Ä–∏–±—ã–ª—å –∑–∞ —Ç–∞–ø</button>
      <button class="upgrade-tab" data-target="character">–ü–µ—Ä—Å–æ–Ω–∞–∂</button>
    </div>

    <div id="upgrade-profit" class="upgrade-content active"></div>

    <div id="upgrade-character" class="upgrade-content">
      <p style="font-size:22px; color:#fff;">–í—ã–±–µ—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</p>

      <div id="charSelect">

        <!-- –ë–∞—Ä—Å—É–∫ -->
        <div class="char-choice" data-char="barsuk">
          <img src="obichni.png" alt="–ë–∞—Ä—Å—É–∫">
          <p>–ë–∞—Ä—Å—É–∫</p>
        </div>

        <!-- –ú–∞–∫—Å–≤–∏–Ω -->
        <div class="char-choice" data-char="maksvin">
          <img src="maksvin.png" alt="–ú–∞–∫—Å–≤–∏–Ω">
          <p>–ú–∞–∫—Å–≤–∏–Ω</p>
        </div>

        <!-- –î–µ–º–æ–º–∞–∫—Å -->
        <div class="char-choice" data-char="demomaks">
          <img src="demomaks.png" alt="–î–µ–º–æ–º–∞–∫—Å">
          <p>–î–µ–º–æ–º–∞–∫—Å</p>
        </div>

        <!-- –ù–û–í–´–ô –ü–ï–†–°–û–ù–ê–ñ: –ö–û–¢–û–ú–ê–ö–° -->
        <div class="char-choice" data-char="kotomaks">
          <img src="KOTOMAKS.png" alt="–ö–æ—Ç–æ–º–∞–∫—Å">
          <p>–ö–æ—Ç–æ–º–∞–∫—Å</p>
        </div>

      </div>
    </div>
  </div>

  <div id="airdrop-screen">
    <button id="showLeaderboardBtn" class="upgrade-btn">üìä –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</button>
    <div id="leaderboardBox" style="margin-top:20px; color:white; font-size:20px; text-align:center;"></div>
  </div>

  <div id="gameMenu">
    <button class="menuBtn">–£–ª—É—á—à–µ–Ω–∏—è</button>
    <button class="menuBtn">–ú–∞–π–Ω–∏–Ω–≥</button>
    <button class="menuBtn">–ê–∏—Ä–¥—Ä–æ–ø</button>
  </div>

  <div id="upgrade-msg" class="hidden"></div>
</div>

<script>
(function(){
  // ---- —ç–ª–µ–º–µ–Ω—Ç—ã ----
  var ch = document.getElementById('character');
  var wrapper = document.getElementById('characterWrapper');
  var counter = document.getElementById('counter');
  var counterNumber = document.getElementById('counterNumber');
  var loader = document.getElementById('loader');
  var menuBtns = document.querySelectorAll('.menuBtn');
  var upgradeScreen = document.getElementById('upgrade-screen');
  var airdropScreen = document.getElementById('airdrop-screen');
  var upgradeMsg = document.getElementById('upgrade-msg');
  var upgradeTabs = document.querySelectorAll('.upgrade-tab');
  var upgradeContents = document.querySelectorAll('.upgrade-content');
  var charChoices = Array.prototype.slice.call(document.querySelectorAll('.char-choice'));

  // ---- –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã ----
  var score = parseInt(localStorage.getItem('svinkoini')) || 0;
  var multiplier = parseInt(localStorage.getItem('multiplier')) || 1;
  var currentCharacter = localStorage.getItem('character') || 'barsuk';
  counterNumber.textContent = score;

  // ---- –º—É–∑—ã–∫–∞ ----
  var musicMap = {
    barsuk: 'mellroy.mp3',
    maksvin: 'morgen.mp3',
    demomaks: 'sila.mp3',
    kotomaks: 'maksdor.mp3'   // ‚Üê –º—É–∑—ã–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
  };

  var bgMusic = new Audio(musicMap[currentCharacter]);
  bgMusic.loop = true;
  bgMusic.volume = 0.5;
  var bgMusicStarted = false;

  function startMusicOnce(){
    if(!bgMusicStarted){
      try { bgMusic.play(); } catch(e){}
      bgMusicStarted = true;
    }
  }

  function changeMusic(character){
    try { bgMusic.pause(); } catch(e){}
    bgMusic = new Audio(musicMap[character]);
    bgMusic.loop = true;
    bgMusic.volume = 0.5;
    if(bgMusicStarted){
      try { bgMusic.play(); } catch(e){}
    }
  }

  // ---- –≤–∏–∑—É–∞–ª—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ----
  var normal = 'obichni.png';
  var press = 'jmy.png';

  function createPlus(x,y,amount){
    var el = document.createElement('div');
    el.className = 'coin';
    el.textContent = '+' + amount;
    var rect = wrapper.getBoundingClientRect();
    el.style.left = (x - rect.left + (Math.random()-0.5)*40) + 'px';
    el.style.top = (y - rect.top + (Math.random()-0.5)*20) + 'px';
    wrapper.appendChild(el);
    setTimeout(function(){ if(el.parentNode) el.parentNode.removeChild(el); }, 800);
  }

  function doTap(x,y,times){
    if(!times || times < 1) times = 1;
    for(var i=0;i<times;i++){
      score += multiplier;
      createPlus(x,y,multiplier);
    }
    localStorage.setItem('svinkoini', score);
    counterNumber.textContent = score;

    wrapper.style.transform = 'translateX(-50%) scale(1.08)';
    if(currentCharacter === 'barsuk'){
      ch.src = press;
      setTimeout(function(){ wrapper.style.transform='translateX(-50%) scale(1)'; ch.src = normal; }, 140);
    } else {
      setTimeout(function(){ wrapper.style.transform='translateX(-50%) scale(1)'; }, 140);
    }

    startMusicOnce();
    try { updateRank(); } catch(e){}
  }

  function showUpgradeMsg(text){
    upgradeMsg.textContent = text;
    upgradeMsg.classList.remove('hidden');
    upgradeMsg.style.opacity = 1;
    setTimeout(function(){
      upgradeMsg.style.opacity = 0;
      setTimeout(function(){ upgradeMsg.classList.add('hidden'); }, 300);
    }, 1500);
  }

  // ---- –≤–∫–ª–∞–¥–∫–∏ ----
  upgradeTabs.forEach(function(tab){
    tab.addEventListener('click', function(){
      upgradeTabs.forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');

      var target = tab.getAttribute('data-target');
      upgradeContents.forEach(c=>c.classList.remove('active'));
      document.getElementById('upgrade-' + target).classList.add('active');
    });
  });
  // ---- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ----
  if(menuBtns[0]) menuBtns[0].addEventListener('click', function(){
    upgradeScreen.style.display='flex';
    upgradeScreen.classList.add('active');
    airdropScreen.style.display='none';
    wrapper.style.opacity=0;
    counter.style.opacity=0;

    document.getElementById('rank').style.display = 'none';
    document.getElementById('rank-popup').style.display = 'none';
  });

  if(menuBtns[1]) menuBtns[1].addEventListener('click', function(){
    upgradeScreen.style.display='none';
    airdropScreen.style.display='none';
    wrapper.style.opacity=1;
    counter.style.opacity=1;

    document.getElementById('rank').style.display = 'block';
    document.getElementById('rank-popup').style.display = 'block';
  });

  if(menuBtns[2]) menuBtns[2].addEventListener('click', function(){
    airdropScreen.style.display='flex';
    upgradeScreen.style.display='none';
    wrapper.style.opacity=0;
    counter.style.opacity=0;

    document.getElementById('rank').style.display = 'none';
    document.getElementById('rank-popup').style.display = 'none';
  });


  // ---- –£–ª—É—á—à–µ–Ω–∏—è x1000 ----
  var upgradeContainer = document.getElementById('upgrade-profit');
  if(upgradeContainer){
    upgradeContainer.innerHTML = '<button id="upgrade-btn" class="upgrade-btn">–£–ª—É—á—à–∏—Ç—å –¥–æ x2</button>';
  }
  var upgradeBtn = document.getElementById('upgrade-btn');

  function nextUpgradeCost(mult){
    return Math.floor(1000 * Math.pow(2, mult - 1));
  }

  function updateUpgradeButton(){
    if(multiplier >= 1000){
      upgradeBtn.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ';
      upgradeBtn.disabled = true;
      upgradeBtn.style.backgroundColor = '#555';
      return;
    }
    var next = multiplier + 1;
    var cost = nextUpgradeCost(multiplier);
    upgradeBtn.textContent = '–ö—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ x' + next + ' –∑–∞ ' + cost + ' üê∑';
  }

  if(upgradeBtn){
    upgradeBtn.addEventListener('click', function(){
      var cost = nextUpgradeCost(multiplier);
      if(score >= cost){
        score -= cost;
        multiplier += 1;

        localStorage.setItem('multiplier', multiplier);
        localStorage.setItem('svinkoini', score);
        counterNumber.textContent = score;

        showUpgradeMsg('–ö—É–ø–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä—å 1 —Ç–∞–ø = ' + multiplier);

        updateUpgradeButton();
        try { updateRank(); } catch(e){}

      } else {
        showUpgradeMsg('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–∏–Ω–∫–æ–π–Ω–æ–≤!');
      }
    });
  }
  updateUpgradeButton();


  // ---- –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ ----
  function updateCounterPosition(){
    var isMobile = window.innerWidth < 768;

    if(currentCharacter === 'barsuk') {
      counter.style.bottom = isMobile
        ? 'calc(160px + 50vh + 8px)'
        : 'calc(160px + 55vh + 8px)';
    } else {
      counter.style.bottom = isMobile
        ? 'calc(140px + 36vh + 8px)'
        : 'calc(140px + 34vh + 8px)';
    }
  }


  // ---- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ----
  function updateCharacterView(){
    // –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–º–∫–∞
    charChoices.forEach(c=>{
      if(c.getAttribute('data-char') === currentCharacter)
        c.classList.add('active');
      else
        c.classList.remove('active');
    });

    // –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    if(currentCharacter === 'barsuk') ch.src = 'obichni.png';
    else if(currentCharacter === 'maksvin') ch.src = 'maksvin.png';
    else if(currentCharacter === 'demomaks') ch.src = 'demomaks.png';
    else if(currentCharacter === 'kotomaks') ch.src = 'KOTOMAKS.png';

    // --- –ù–æ–≤—ã–π –∫–æ–¥ —Å–º–µ–Ω—ã —Ñ–æ–Ω–∞ ---
if (currentCharacter === 'demomaks') {
    // —Ñ–æ–Ω –¥–ª—è –î–µ–º–æ–º–∞–∫—Å–∞
    document.body.style.backgroundImage = "url('doma.jpg')";
}

else if (currentCharacter === 'maksvin') {
    // —Ñ–æ–Ω –¥–ª—è –ú–∞–∫—Å–≤–∏–Ω–∞
    document.body.style.backgroundImage = "url('sviari.jpg')";
}
else {
    // —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
    document.body.style.backgroundImage = "url('background.jpg')";
}
    // ==== –û–ì–ù–ï–ù–ù–´–ô –°–ß–Å–¢–ß–ò–ö –¢–û–õ–¨–ö–û –î–õ–Ø –î–ï–ú–û–ú–ê–ö–° ====
var cn = document.getElementById("counterNumber");
var ct = document.getElementById("counterText");

if (currentCharacter === 'demomaks') {
    cn.classList.add("fire-counter", "fire-smoke");
    ct.classList.add("fire-counter");
} else {
    cn.classList.remove("fire-counter", "fire-smoke");
    ct.classList.remove("fire-counter");
}// -------------------------------------
  

    updateCounterPosition();
  }


  // ---- –≤—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ----
  charChoices.forEach(function(c){
    c.addEventListener('click', function(){
      currentCharacter = c.getAttribute('data-char');
      localStorage.setItem('character', currentCharacter);

      updateCharacterView();
      changeMusic(currentCharacter);

      var name = c.querySelector('p').textContent;
      showUpgradeMsg('–í—ã–±—Ä–∞–Ω: ' + name);

      try { updateRank(); } catch(e){}
    });
  });


  // ---- –∑–∞–ø—É—Å–∫ ----
  updateCharacterView();

  try {
    bgMusic = new Audio(musicMap[currentCharacter]);
    bgMusic.loop = true;
    bgMusic.volume = 0.5;
  } catch(e){}


  // ---- —Ç–∞–ø—ã ----
  function pointerHandler(e){
    var x = (e.clientX !== undefined) ? e.clientX : e.touches[0].clientX;
    var y = (e.clientY !== undefined) ? e.clientY : e.touches[0].clientY;

    doTap(x,y,1);
    if(e.preventDefault) e.preventDefault();
  }

  ch.addEventListener('pointerdown', pointerHandler);
  ch.addEventListener('touchstart', pointerHandler, { passive:false });


  // ---- –ª–æ–∞–¥–µ—Ä ----
  window.addEventListener('load', function(){
    setTimeout(function(){ loader.style.display='none'; }, 4000);
  });


  // ---- –†–ê–ù–ì–ò ----
  var rankLevels = [
    { score: 0, title: '–ü—Ä–∞—Å–∫—É—Ä–∏–æ—Ç ü§µüèø‚Äç‚ôÇÔ∏è' },
    { score: 100, title: '–ü–æ—Ç–Ω—ã–π —Å–≤–∏–Ω üê∑' },
    { score: 1000, title: '–°–≤–∏–Ω–æ –§–µ—Ä–º–µ—Ä üë®‚Äçüåæ' },
    { score: 10000, title: '–ú–∞–∫—Å–≤–∏–Ω üí∞' },
    { score: 100000, title: '–ú–∞–∫—Å –ú–∞–∫—Å–±–µ—Ç–æ–≤ üè¶' },
    { score: 1000000, title: '–°–≤–∏–Ω–æ–ª–æ—Ä–¥ üëë' }
  ];

  var currentRankIndex = 0;
  var rankAudio = new Audio('rankup.mp3');

  var flashEl = document.createElement('div');
  flashEl.id = 'rank-flash';
  flashEl.style.position = 'fixed';
  flashEl.style.top = '0';
  flashEl.style.left = '0';
  flashEl.style.width = '100vw';
  flashEl.style.height = '100vh';
  flashEl.style.background = 'radial-gradient(circle, rgba(255,255,200,0.6), transparent 70%)';
  flashEl.style.opacity = 0;
  flashEl.style.pointerEvents = 'none';
  flashEl.style.transition = 'opacity 0.4s ease';
  document.body.appendChild(flashEl);

  function getRankByScore(v){
    var idx = 0;
    for(var i=0;i<rankLevels.length;i++){
      if(v >= rankLevels[i].score) idx = i;
    }
    return idx;
  }

  function updateRank(){
    var rankEl = document.getElementById('rank');
    var popup = document.getElementById('rank-popup');

    var newRankIndex = getRankByScore(score);

    rankEl.textContent = '–†–∞–Ω–≥: ' + rankLevels[newRankIndex].title;

    if(newRankIndex > currentRankIndex){
      currentRankIndex = newRankIndex;

      popup.textContent = 'üéâ –ù–æ–≤—ã–π —Ä–∞–Ω–≥: ' + rankLevels[newRankIndex].title;
      popup.classList.remove('hidden');
      popup.classList.add('show');

      setTimeout(()=>popup.classList.remove('show'), 2000);
      setTimeout(()=>popup.classList.add('hidden'), 2600);

      try { rankAudio.currentTime = 0; rankAudio.play(); } catch(e){}
      if(navigator.vibrate) navigator.vibrate([200,100,200]);

      flashEl.style.opacity = 1;
      setTimeout(()=>flashEl.style.opacity = 0, 600);
    }
  }

  updateRank();

})(); // –∫–æ–Ω–µ—Ü –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏


// --- Telegram WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ---
const tg = window.Telegram?.WebApp;
if (tg) {
  tg.expand();

  function sendScoreToBot() {
    const data = { score: score };
    tg.sendData(JSON.stringify(data));
  }

  setInterval(sendScoreToBot, 10000);
}
</script>

</body>
</html>
