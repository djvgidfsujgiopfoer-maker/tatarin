<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–¢–∞–ø–∞–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
<style>
html, body {
  height: 100%;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  background: url('background.jpg') no-repeat center bottom;
  background-size: cover;
  font-family: Arial, sans-serif;
  overflow: hidden;
  user-select: none;
}
body, #character { touch-action: manipulation; }

#gameWrap {
  position: relative;
  width: 90vw;
  max-width: 400px;
  height: 100vh;
  text-align: center;
  overflow: visible;
}

/* –°—á—ë—Ç—á–∏–∫ */
#counter {
  position: absolute;
  bottom: calc(160px + 34vh + 8px);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 0;
  pointer-events: none;
  z-index: 20;
  white-space: nowrap;
  transition: bottom 0.25s ease, opacity 0.3s ease;
}
@media (max-width: 768px) {
  #counter {
    bottom: calc(140px + 60vh + 8px);
  }
}
#counter img { height: clamp(100px,10vw,70px); width: auto; vertical-align: middle; }
#counterNumber { font-weight: bold; font-size: clamp(20px,6vw,40px); color: #3c9c44; text-shadow:2px 2px 4px rgba(0,0,0,0.4); line-height:1; transform:translateY(-2px); }

/* –ü–µ—Ä—Å–æ–Ω–∞–∂ */
#characterWrapper {
  position: absolute;
  bottom: 125px;
  left: 50%;
  transform: translateX(-50%) scale(1);
  transform-origin: center bottom;
  width: 90%;
  max-width: 320px;
  height: clamp(220px, 34vh, 320px);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  transition: transform 0.12s ease, opacity 0.3s ease;
  z-index: 10;
}
#character {
  display:block;
  width:100%;
  height:auto;
  cursor:pointer;
  -webkit-user-drag:none;
  user-drag:none;
}

/* –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é */
#gameMenu {
  display:flex;
  justify-content:center;
  height:120px;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,0.3);
  z-index:50;
  position: fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:12px;
  width:90vw;
  max-width:420px;
  background-color:#27792e;
}
.menuBtn { flex:1; background-color:#1c441f; color:#fff; font-weight:bold; font-size:clamp(20px,5vw,28px); padding:25px 0; border:none; cursor:pointer; transition: background-color 0.2s ease, transform 0.1s ease; }
.menuBtn:not(:last-child) { border-right:1px solid rgba(255,255,255,0.3); }
.menuBtn:hover { background-color:#2e8c34; transform: scale(1.02); }

/* –≠—Ñ—Ñ–µ–∫—Ç + */
.coin { position:absolute; font-size:clamp(14px,4vw,24px); font-weight:bold; color:rgb(0,255,76); pointer-events:none; animation:coinAnim 0.8s forwards; text-shadow:0 1px 2px rgba(0,0,0,0.3); white-space:nowrap; z-index:999; }
@keyframes coinAnim { 0%{opacity:1; transform:translateY(0) scale(1);} 40%{transform:translateY(-26px) scale(1.4);} 80%{transform:translateY(-48px) scale(1.1); opacity:0.6;} 100%{transform:translateY(-70px) scale(0.6); opacity:0;} }

/* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
#loader { position:fixed; top:0; left:0; width:100vw; height:100vh; background:#000; display:flex; justify-content:center; align-items:center; z-index:9999; overflow:hidden; }
#loader video {height:100%; width:auto; object-fit:contain; }
.hidden { display:none; }

/* –í–∫–ª–∞–¥–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π –∏ AirDrop */
#upgrade-screen, #airdrop-screen {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:calc(100% - 120px);
  display:none;
  flex-direction:column;
  justify-content:flex-start;
  align-items:center;
  z-index:30;
  background: rgba(0,0,0,0.3);
  opacity:0;
  transition: opacity 0.3s ease;
}
#upgrade-screen.active, #airdrop-screen.active { display:flex; opacity:1; }

/* –í–∫–ª–∞–¥–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π */
#upgrade-tabs { display:flex; justify-content:center; margin-top:60px; margin-bottom:40px; gap:20px; }
.upgrade-tab { background-color:#1c441f; color:#fff; font-weight:bold; font-size:clamp(16px,4vw,24px); padding:14px 28px; border-radius:10px; cursor:pointer; transition:background-color 0.2s ease, transform 0.1s ease; border:none; }
.upgrade-tab.active { background-color:#3da64b; }
.upgrade-tab:hover { background-color:#2e8c34; transform:scale(1.05); }

/* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
.upgrade-content { display:none; flex-direction:column; align-items:center; justify-content:center; flex-grow:1; opacity:0; transition: opacity 0.3s ease; }
.upgrade-content.active { display:flex; opacity:1; }
.upgrade-btn { padding:20px 100px; font-size:clamp(18px,5vw,28px); cursor:pointer; border:none; border-radius:20px; background-color:#2e8c34; color:#fff; font-weight:bold; box-shadow:0 4px 8px rgba(0,0,0,0.3); transition:transform 0.1s ease, background-color 0.2s ease; margin-top:15px; }

/* –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ */
#charSelect { display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin-top:6px; width:100%; }
.char-choice { width:140px; text-align:center; cursor:pointer; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; }
.char-choice img { width:120px; height:120px; object-fit:contain; border-radius:10px; border:3px solid transparent; background:rgba(0,0,0,0.18); display:block; }
.char-choice.active img { border:3px solid #3da64b; box-shadow:0 6px 18px rgba(0,0,0,0.35); }
.char-choice p { color:#fff; font-size:16px; font-weight:700; margin:8px 0 0 0; }

/* –°–æ–æ–±—â–µ–Ω–∏–µ */
#upgrade-msg { position:absolute; top:10%; left:50%; transform:translateX(-50%); background:rgba(50,150,60,0.9); color:#fff; font-size:clamp(18px,5vw,26px); padding:12px 24px; border-radius:10px; z-index:300; pointer-events:none; opacity:0; transition:opacity 0.3s ease; }

/* –†–∞–Ω–≥–∏ –∏ popup */
#rank {
  position: absolute;
  top: 12%;
  left: 50%;
  transform: translateX(-50%);
  color: #fff;
  font-size: clamp(18px, 5vw, 24px);
  text-shadow: 1px 1px 3px #000;
  font-weight: bold;
  z-index: 25;
}
#rank-popup {
  position: absolute;
  top: 30%;
  left: 50%;
  transform: translateX(-50%) scale(1);
  color: #ffe75e;
  background: rgba(0,0,0,0.7);
  padding: 14px 24px;
  border-radius: 12px;
  font-size: clamp(18px, 6vw, 28px);
  font-weight: bold;
  text-shadow: 0 0 10px #fff;
  opacity: 0;
  z-index: 999;
  transition: opacity 0.5s ease, transform 0.5s ease;
}
#rank-popup.show {
  opacity: 1;
  transform: translateX(-50%) scale(1.1);
}
/* –í—Å–ø—ã—à–∫–∞ —Ñ–æ–Ω–∞ –ø—Ä–∏ –Ω–æ–≤–æ–º —Ä–∞–Ω–≥–µ */
#rank-flash {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: radial-gradient(circle, rgba(255,255,200,0.6), transparent 70%);
  opacity: 0;
  z-index: 1000;
  pointer-events: none;
  transition: opacity 0.4s ease;
}
#rank-flash.active {
  opacity: 1;
}
</style>
</head>
<body>

<div id="loader">
  <video autoplay muted playsinline>
    <source src="pivko.mp4" type="video/mp4">
  </video>
</div>

<div id="gameWrap">
  <div id="counter">
    <img src="govno.png" alt="–°–≤–∏–Ω–∫–æ–π–Ω–æ–≤" id="counterText">
    <span id="counterNumber">0</span>
  </div>

  <div id="rank">–†–∞–Ω–≥: –ü—Ä–∞—Å–∫—É—Ä–∏–æ—Ç ü§µüèø‚Äç‚ôÇÔ∏è</div>
  <div id="rank-popup" class="hidden">üéâ –ù–æ–≤—ã–π —Ä–∞–Ω–≥!</div>

  <div id="characterWrapper">
    <img id="character" src="obichni.png" alt="–ü–µ—Ä—Å–æ–Ω–∞–∂">
  </div>

  <div id="upgrade-screen">
    <div id="upgrade-tabs">
      <button class="upgrade-tab active" data-target="profit">–ü—Ä–∏–±—ã–ª—å –∑–∞ —Ç–∞–ø</button>
      <button class="upgrade-tab" data-target="character">–ü–µ—Ä—Å–æ–Ω–∞–∂</button>
    </div>
    <div id="upgrade-profit" class="upgrade-content active"></div>
    <div id="upgrade-character" class="upgrade-content">
      <p style="font-size:22px; color:#fff;">–í—ã–±–µ—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</p>
      <div id="charSelect">
        <div class="char-choice" data-char="barsuk">
          <img src="obichni.png" alt="–ë–∞—Ä—Å—É–∫">
          <p>–ë–∞—Ä—Å—É–∫</p>
        </div>
        <div class="char-choice" data-char="maksvin">
          <img src="maksvin.png" alt="–ú–∞–∫—Å–≤–∏–Ω">
          <p>–ú–∞–∫—Å–≤–∏–Ω</p>
        </div>
        <div class="char-choice" data-char="demomaks">
          <img src="demomaks.png" alt="–î–µ–º–æ–º–∞–∫—Å">
          <p>–î–µ–º–æ–º–∞–∫—Å</p>
        </div>
      </div>
    </div>
  </div>

  <div id="airdrop-screen">
  <button id="showLeaderboardBtn" class="upgrade-btn">üìä –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</button>
  <div id="leaderboardBox" style="margin-top:20px; color:white; font-size:20px; text-align:center;"></div>
</div>

  <div id="gameMenu">
    <button class="menuBtn">–£–ª—É—á—à–µ–Ω–∏—è</button>
    <button class="menuBtn">–ú–∞–π–Ω–∏–Ω–≥</button>
    <button class="menuBtn">–ê–∏—Ä–¥—Ä–æ–ø</button>
  </div>

  <div id="upgrade-msg" class="hidden"></div>
</div>

<script>
(function(){
  // ---- —ç–ª–µ–º–µ–Ω—Ç—ã ----
  var ch = document.getElementById('character');
  var wrapper = document.getElementById('characterWrapper');
  var counter = document.getElementById('counter');
  var counterNumber = document.getElementById('counterNumber');
  var loader = document.getElementById('loader');
  var menuBtns = document.querySelectorAll('.menuBtn');
  var upgradeScreen = document.getElementById('upgrade-screen');
  var airdropScreen = document.getElementById('airdrop-screen');
  var upgradeMsg = document.getElementById('upgrade-msg');
  var upgradeTabs = document.querySelectorAll('.upgrade-tab');
  var upgradeContents = document.querySelectorAll('.upgrade-content');
  var charChoices = Array.prototype.slice.call(document.querySelectorAll('.char-choice'));

  // ---- –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã ----
  var score = parseInt(localStorage.getItem('svinkoini')) || 0;
  var multiplier = parseInt(localStorage.getItem('multiplier')) || 1;
  var currentCharacter = localStorage.getItem('character') || 'barsuk';
  counterNumber.textContent = score;

  // ---- –º—É–∑—ã–∫–∞ (map) ----
  var musicMap = {
    barsuk: 'mellroy.mp3',
    maksvin: 'morgen.mp3',
    demomaks: 'sila.mp3'
  };

  // —Å–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç –º—É–∑—ã–∫–∏, –Ω–æ –ù–ï –∑–∞–ø—É—Å–∫–∞–µ–º
  var bgMusic = new Audio(musicMap[currentCharacter]);
  bgMusic.loop = true;
  bgMusic.volume = 0.5;
  var bgMusicStarted = false; // —Å—Ç–∞–Ω–µ—Ç true –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ç–∞–ø–∞

  // —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –º—É–∑—ã–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ç–∞–ø–µ
  function startMusicOnce(){
    if(!bgMusicStarted){
      try { bgMusic.play(); } catch(e){}
      bgMusicStarted = true;
    }
  }

  // —Ñ—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —Ç—Ä—ç–∫–∞ (–µ—Å–ª–∏ –º—É–∑—ã–∫–∞ —É–∂–µ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞ ‚Äî –Ω–æ–≤–∞—è –ø–æ–π–¥—ë—Ç —Å—Ä–∞–∑—É)
  function changeMusic(character){
    try { bgMusic.pause(); } catch(e){}
    bgMusic = new Audio(musicMap[character]);
    bgMusic.loop = true;
    bgMusic.volume = 0.5;
    if(bgMusicStarted){
      try { bgMusic.play(); } catch(e){}
    }
  }

  // ---- –≤–∏–∑—É–∞–ª—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ----
  var normal = 'obichni.png';
  var press = 'jmy.png';

  function createPlus(x,y,amount){
    var el = document.createElement('div');
    el.className = 'coin';
    el.textContent = '+' + amount;
    var rect = wrapper.getBoundingClientRect();
    el.style.left = (x - rect.left + (Math.random()-0.5)*40) + 'px';
    el.style.top = (y - rect.top + (Math.random()-0.5)*20) + 'px';
    wrapper.appendChild(el);
    setTimeout(function(){ if(el.parentNode) el.parentNode.removeChild(el); }, 800);
  }

  // ---- —Ç–∞–ø (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤) ----
  function doTap(x,y,times){
    if(!times || times < 1) times = 1;
    for(var i=0;i<times;i++){
      score += multiplier;
      createPlus(x,y,multiplier);
    }
    localStorage.setItem('svinkoini', score);
    counterNumber.textContent = score;
    wrapper.style.transform = 'translateX(-50%) scale(1.08)';
    if(currentCharacter === 'barsuk'){
      ch.src = press;
      setTimeout(function(){ wrapper.style.transform='translateX(-50%) scale(1)'; ch.src = normal; }, 140);
    } else {
      setTimeout(function(){ wrapper.style.transform='translateX(-50%) scale(1)'; }, 140);
    }
    // –∑–∞–ø—É—Å–∫–∞–µ–º –º—É–∑—ã–∫—É —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ç–∞–ø–µ
    startMusicOnce();

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–Ω–≥ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—á—ë—Ç–∞
    try { updateRank(); } catch(e){}
  }

  // ---- —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–ø–≥—Ä–µ–π–¥–æ–≤ ----
  function showUpgradeMsg(text){
    upgradeMsg.textContent = text;
    upgradeMsg.classList.remove('hidden');
    upgradeMsg.style.opacity = 1;
    setTimeout(function(){
      upgradeMsg.style.opacity = 0;
      setTimeout(function(){ upgradeMsg.classList.add('hidden'); }, 300);
    }, 1500);
  }

  // ---- —Ç–∞–±—ã –≤ –∞–ø–≥—Ä–µ–π–¥–∞—Ö ----
  for(var ti=0; ti<upgradeTabs.length; ti++){
    (function(tab){
      tab.addEventListener('click', function(){
        for(var j=0;j<upgradeTabs.length;j++) upgradeTabs[j].classList.remove('active');
        tab.classList.add('active');
        var target = tab.getAttribute('data-target');
        for(var k=0;k<upgradeContents.length;k++) upgradeContents[k].classList.remove('active');
        var tgt = document.getElementById('upgrade-' + target);
        if(tgt) tgt.classList.add('active');
      });
    })(upgradeTabs[ti]);
  }

  // ---- –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ----
 if(menuBtns[0]) menuBtns[0].addEventListener('click', function(){
  // –≤–∫–ª–∞–¥–∫–∞ "–£–ª—É—á—à–µ–Ω–∏—è"
  upgradeScreen.style.display='flex'; upgradeScreen.classList.add('active');
  airdropScreen.style.display='none';
  wrapper.style.opacity=0; counter.style.opacity=0;

  // —Å–∫—Ä—ã–≤–∞–µ–º —Ä–∞–Ω–≥ –∏ –≤—Å–ø–ª—ã–≤–∞—à–∫—É
  document.getElementById('rank').style.display = 'none';
  document.getElementById('rank-popup').style.display = 'none';
});

if(menuBtns[1]) menuBtns[1].addEventListener('click', function(){
  // –≤–∫–ª–∞–¥–∫–∞ "–ú–∞–π–Ω–∏–Ω–≥"
  upgradeScreen.style.display='none'; airdropScreen.style.display='none';
  wrapper.style.opacity=1; counter.style.opacity=1;

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–Ω–≥ –∏ –≤—Å–ø–ª—ã–≤–∞—à–∫—É
  document.getElementById('rank').style.display = 'block';
  document.getElementById('rank-popup').style.display = 'block';
});

if(menuBtns[2]) menuBtns[2].addEventListener('click', function(){
  // –≤–∫–ª–∞–¥–∫–∞ "–ê–∏—Ä–¥—Ä–æ–ø"
  airdropScreen.style.display='flex'; upgradeScreen.style.display='none';
  wrapper.style.opacity=0; counter.style.opacity=0;

  // —Å–∫—Ä—ã–≤–∞–µ–º —Ä–∞–Ω–≥ –∏ –≤—Å–ø–ª—ã–≤–∞—à–∫—É
  document.getElementById('rank').style.display = 'none';
  document.getElementById('rank-popup').style.display = 'none';
});

  // ---- –∞–ø–≥—Ä–µ–π–¥—ã –¥–æ x1000 (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å) ----
  var upgradeContainer = document.getElementById('upgrade-profit');
  if(upgradeContainer){
    upgradeContainer.innerHTML = '<button id="upgrade-btn" class="upgrade-btn">–£–ª—É—á—à–∏—Ç—å –¥–æ x2</button>';
  }
  var upgradeBtn = document.getElementById('upgrade-btn');

  function nextUpgradeCost(mult){
    // –∞–∫–∫—É—Ä–∞—Ç–Ω–æ: —á–∏—Å–ª–∞ –±–æ–ª—å—à–∏–µ, –Ω–æ –¥–ª—è –∏–≥—Ä—ã –ø–æ–π–¥—ë—Ç
    return Math.floor(100 * Math.pow(2, mult - 1));
  }

  function updateUpgradeButton(){
    if(!upgradeBtn) return;
    if(multiplier >= 1000){
      upgradeBtn.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ';
      upgradeBtn.disabled = true;
      upgradeBtn.style.backgroundColor = '#555';
      return;
    }
    var next = multiplier + 1;
    var cost = nextUpgradeCost(multiplier);
    upgradeBtn.textContent = '–ö—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ x' + next + ' –∑–∞ ' + cost + ' üê∑';
  }

  if(upgradeBtn){
    upgradeBtn.addEventListener('click', function(){
      var cost = nextUpgradeCost(multiplier);
      if(score >= cost){
        score -= cost;
        multiplier += 1;
        localStorage.setItem('multiplier', multiplier);
        localStorage.setItem('svinkoini', score);
        counterNumber.textContent = score;
        showUpgradeMsg('–ö—É–ø–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä—å 1 —Ç–∞–ø = ' + multiplier + ' —Å–≤–∏–Ω–∫–æ–π–Ω(–æ–≤)');
        updateUpgradeButton();
        try { updateRank(); } catch(e){}
      } else {
        showUpgradeMsg('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–∏–Ω–∫–æ–π–Ω–æ–≤!');
      }
    });
  }
  updateUpgradeButton();

  // ---- –ø–æ–∑–∏—Ü–∏—è —Å—á—ë—Ç—á–∏–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ----
  function updateCounterPosition(){
    var isMobile = window.innerWidth < 768;
    if(currentCharacter === 'barsuk') {
      // –Ω–∞ –ü–ö —á—É—Ç—å –ø–æ–¥–Ω—è—Ç—å, –Ω–∞ –º–æ–±–∏–ª–∫–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
      counter.style.bottom = isMobile
        ? 'calc(160px + 50vh + 8px)'
        : 'calc(160px + 55vh + 8px)';
    } else {
      counter.style.bottom = isMobile
        ? 'calc(140px + 36vh + 8px)'
        : 'calc(140px + 34vh + 8px)';
    }
  }

  // ---- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ----
  function updateCharacterView(){
    for(var ci=0; ci<charChoices.length; ci++){
      var c = charChoices[ci];
      if(c.getAttribute('data-char') === currentCharacter) c.classList.add('active'); else c.classList.remove('active');
    }

    if(currentCharacter === 'barsuk') ch.src = 'obichni.png';
    else if(currentCharacter === 'maksvin') ch.src = 'maksvin.png';
    else if(currentCharacter === 'demomaks') ch.src = 'demomaks.png';

    updateCounterPosition();
  }

  // ---- –∫–ª–∏–∫–∏ –ø–æ –≤—ã–±–æ—Ä—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ----
  for(var ci2=0; ci2<charChoices.length; ci2++){
    (function(c){
      c.addEventListener('click', function(){
        currentCharacter = c.getAttribute('data-char');
        localStorage.setItem('character', currentCharacter);
        updateCharacterView();
        // –µ—Å–ª–∏ –º—É–∑—ã–∫–∞ —É–∂–µ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞ ‚Äî —Å—Ä–∞–∑—É –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º,
        // –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–º–µ–Ω–∞ —Ç—Ä–µ–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç bgMusic –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
        changeMusic(currentCharacter);
        try { updateRank(); } catch(e){}
        showUpgradeMsg('–í—ã–±—Ä–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–∂: ' + (c.querySelector('p') ? c.querySelector('p').textContent : currentCharacter));
      });
    })(charChoices[ci2]);
  }

  // ---- —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –≤—ã–∑–æ–≤—ã ----
  updateCharacterView();
  try { bgMusic = new Audio(musicMap[currentCharacter]); bgMusic.loop = true; bgMusic.volume = 0.5; } catch(e){}

  // ---- —Ç–∞–ø—ã –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ ----
  function pointerHandler(e){
    var x = (typeof e.clientX !== 'undefined') ? e.clientX : (e.touches && e.touches[0] && e.touches[0].clientX);
    var y = (typeof e.clientY !== 'undefined') ? e.clientY : (e.touches && e.touches[0] && e.touches[0].clientY);
    doTap(x,y,1);
    if(e.preventDefault) e.preventDefault();
  }

  if(ch.addEventListener){
    ch.addEventListener('pointerdown', pointerHandler);
    ch.addEventListener('touchstart', pointerHandler, { passive: false });
  } else {
    ch.ontouchstart = pointerHandler;
    ch.onmousedown = pointerHandler;
  }

  // ---- –ª–æ–∞–¥–µ—Ä: —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ----
  if(window.addEventListener){
    window.addEventListener('load', function(){
      try { setTimeout(function(){ loader.style.display='none'; }, 4000); } catch(e){}
    });
  } else {
    window.onload = function(){ try { setTimeout(function(){ loader.style.display='none'; }, 4000); } catch(e){} };
  }

  /* ===========================
     –†–ê–ù–ì–ò + –≤—Å–ø—ã—à–∫–∞ + –∑–≤—É–∫
     =========================== */

  // –†–∞–Ω–≥–∏ –ø–æ —Ç–≤–æ–µ–º—É —Å–ø–∏—Å–∫—É
  var rankLevels = [
    { score: 0, title: '–ü—Ä–∞—Å–∫—É—Ä–∏–æ—Ç ü§µüèø‚Äç‚ôÇÔ∏è' },
    { score: 100, title: '–ü–æ—Ç–Ω—ã–π —Å–≤–∏–Ω üê∑' },
    { score: 1000, title: '–°–≤–∏–Ω–æ –§–µ—Ä–º–µ—Ä üë®‚Äçüåæ' },
    { score: 10000, title: '–ú–∞–∫—Å–≤–∏–Ω üí∞' },
    { score: 100000, title: '–ú–∞–∫—Å –ú–∞–∫—Å–±–µ—Ç–æ–≤ üè¶' },
    { score: 1000000, title: '–°–≤–∏–Ω–æ–ª–æ—Ä–¥ üëë' }
  ];

  var currentRankIndex = 0;
  var rankAudio = new Audio('rankup.mp3');

  // —Å–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç –≤—Å–ø—ã—à–∫–∏
  var flashEl = document.createElement('div');
  flashEl.id = 'rank-flash';
  document.body.appendChild(flashEl);

  function getRankByScore(val){
    var idx = 0;
    for(var i=0; i<rankLevels.length; i++){
      if(val >= rankLevels[i].score) idx = i;
    }
    return idx;
  }

  function updateRank(){
    var rankEl = document.getElementById('rank');
    var popup = document.getElementById('rank-popup');
    var newRankIndex = getRankByScore(score);

    if(rankEl) rankEl.textContent = '–†–∞–Ω–≥: ' + rankLevels[newRankIndex].title;

    // –µ—Å–ª–∏ –Ω–æ–≤—ã–π —Ä–∞–Ω–≥
    if(newRankIndex > currentRankIndex){
      currentRankIndex = newRankIndex;

      // –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      popup.textContent = 'üéâ –ù–æ–≤—ã–π —Ä–∞–Ω–≥: ' + rankLevels[newRankIndex].title;
      popup.classList.remove('hidden');
      popup.classList.add('show');
      setTimeout(function(){
        popup.classList.remove('show');
        setTimeout(function(){ popup.classList.add('hidden'); }, 500);
      }, 2000);

      // –∑–≤—É–∫
      try { rankAudio.currentTime = 0; rankAudio.play(); } catch(e){}

      // –≤–∏–±—Ä–∞—Ü–∏—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö
      if (navigator.vibrate) navigator.vibrate([200, 100, 200]);

      // –≤—Å–ø—ã—à–∫–∞
      if(flashEl){
        flashEl.classList.add('active');
        setTimeout(function(){
          flashEl.classList.remove('active');
        }, 600);
      }
    }
  }

  // –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–Ω–≥ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  try { updateRank(); } catch(e){}

})();
// --- Telegram WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ---
const tg = window.Telegram?.WebApp;
if (tg) {
  tg.expand(); // —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ–∫–Ω–æ

  // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Telegram
  function sendScoreToBot() {
    const data = { score: score }; // score ‚Äî —Ç–≤–æ–π —Å—á—ë—Ç—á–∏–∫
    tg.sendData(JSON.stringify(data));
  }

  // –ø—Ä–∏–º–µ—Ä: –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  setInterval(sendScoreToBot, 10000);
}

</script>

</body>
</html>




